<!DOCTYPE html>
<html class="dark" lang="en">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>The Vault // Breach Dashboard</title>
    <link href="https://fonts.googleapis.com" rel="preconnect"/>
    <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500;700&display=swap" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght@100..700,FILL@0..1&display=swap" rel="stylesheet"/>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <script id="tailwind-config">
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#00ff95",
                        "secondary": "#ff0055",
                        "background-dark": "#0f172a",
                        "surface-dark": "#1e293b",
                    },
                    fontFamily: {
                        "display": ["Space Grotesk", "sans-serif"],
                        "mono": ["JetBrains Mono", "monospace"],
                    },
                    backgroundImage: {
                        'grid-pattern': "linear-gradient(to right, #1e293b 1px, transparent 1px), linear-gradient(to bottom, #1e293b 1px, transparent 1px)",
                    },
                },
            },
        }
    </script>
    <style>
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-track { background: #0f172a; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 4px; }
        .neon-glow { box-shadow: 0 0 10px rgba(0, 255, 149, 0.3); }
        .grid-bg { background-size: 40px 40px; mask-image: linear-gradient(to bottom, black 40%, transparent 100%); }
        .scanline {
            width: 100%; height: 2px; background: rgba(0, 255, 149, 0.1);
            position: absolute; top: 0; left: 0; animation: scan 3s linear infinite;
            z-index: 20; pointer-events: none;
        }
        @keyframes scan { 0% { top: 0%; } 100% { top: 100%; } }
    </style>
</head>
<body class="bg-background-dark font-display text-slate-100 min-h-screen flex flex-col overflow-hidden relative">
    <div class="absolute inset-0 z-0 bg-grid-pattern opacity-20 pointer-events-none grid-bg"></div>
    
    <header class="relative z-30 w-full border-b border-white/10 bg-background-dark/80 backdrop-blur-md px-6 py-4 flex items-center justify-between">
        <div class="flex items-center gap-4">
            <div class="size-10 bg-primary/20 rounded-lg flex items-center justify-center text-primary neon-glow border border-primary/40">
                <span class="material-symbols-outlined">security</span>
            </div>
            <div>
                <h1 class="text-xl font-bold tracking-tight text-white uppercase">The Vault <span class="text-primary/50">//</span> Breach Logs</h1>
                <div class="flex items-center gap-2">
                    <span id="status-pulse" class="inline-block size-2 rounded-full bg-primary animate-pulse"></span>
                    <span id="status-text" class="text-[10px] font-mono text-primary tracking-widest uppercase">SYSTEM_ONLINE</span>
                </div>
            </div>
        </div>
        <div id="total-count-header" class="text-primary font-mono font-bold text-sm text-right">TOTAL ATTEMPTS: --</div>
    </header>

    <div class="relative z-10 flex-1 flex flex-col lg:flex-row overflow-hidden">
        <aside class="w-full lg:w-80 border-b lg:border-b-0 lg:border-r border-white/10 bg-surface-dark/30 backdrop-blur-sm flex flex-col p-4 space-y-4 overflow-y-auto">
            <!-- Live Metrics Section -->
            <section>
                <h3 class="text-[10px] font-mono text-slate-400 uppercase tracking-widest flex items-center gap-2 mb-3">
                    <span class="material-symbols-outlined text-sm">analytics</span> Live Metrics
                </h3>
                <div class="space-y-2">
                    <div class="bg-surface-dark border border-primary/20 rounded-lg p-3 relative overflow-hidden">
                        <span class="text-[10px] font-bold text-slate-400 tracking-wider uppercase block mb-1">Unique Breach Patterns</span>
                        <p id="unique-count" class="text-primary font-bold text-2xl font-mono">0</p>
                    </div>
                    <div id="vault-status-box" class="bg-surface-dark border border-primary/20 rounded-lg p-3 relative overflow-hidden transition-colors duration-500">
                        <span class="text-[10px] font-bold text-slate-400 tracking-wider uppercase block mb-1">Vault Status</span>
                        <p id="vault-status-text" class="text-primary font-bold text-lg font-mono uppercase mb-1">SECURE</p>
                        <a href="https://etherscan.io/address/0xa66b9316B5968dAD2507143143C5b8b28614b88E" 
                           target="_blank" 
                           title="0xa66b9316B5968dAD2507143143C5b8b28614b88E"
                           class="text-sm md:text-base text-slate-300 hover:text-primary font-mono font-bold transition-all duration-300">
                            0xa66b...b88E
                        </a>
                    </div>
                </div>
            </section>

            <!-- Agent Arsenal + WebChat Section -->
            <section>
                <h3 class="text-[10px] font-mono text-primary uppercase tracking-widest flex items-center gap-2 mb-3">
                    <span class="material-symbols-outlined text-sm">construction</span> Agent Arsenal
                </h3>
                <div id="arsenal-list" class="grid grid-cols-1 gap-1.5 mb-4"></div>

                <!-- WebChat Interface -->
                <h3 class="text-[10px] font-mono text-slate-200 uppercase tracking-widest flex items-center gap-2 mb-3">
                    <span class="text-primary font-bold">Live</span> Chat with Agent
                </h3>
                <div class="bg-surface-dark border border-primary/20 rounded-lg p-2.5 mb-4">
                    <div id="chat-messages" class="h-32 overflow-y-auto space-y-2 mb-3 text-xs font-mono">
                        <div class="text-slate-500 text-center py-8">
                            <span class="material-symbols-outlined text-2xl text-primary/50 mb-2 block">chat</span>
                            Start a conversation with the AI agent...
                        </div>
                    </div>
                    <div class="flex gap-2">
                        <input type="text" 
                               id="chat-input" 
                               placeholder="Type your message..." 
                               class="flex-1 bg-slate-900 border border-primary/30 rounded px-3 py-2 text-xs font-mono text-white placeholder-slate-500 focus:outline-none focus:border-primary">
                        <button id="chat-send" 
                                class="bg-primary/20 border border-primary/40 rounded px-4 py-2 text-xs font-mono font-bold text-primary hover:bg-primary/30 transition-all flex items-center gap-1">
                            <span class="material-symbols-outlined text-sm">send</span>
                        </button>
                    </div>
                    <div id="chat-status" class="text-[10px] text-slate-500 mt-2 hidden"></div>
                </div>

                <!-- API Attack Guide -->
                <div class="p-2.5 bg-slate-900/80 border border-secondary/30 rounded mb-4">
                    <h3 class="text-[10px] font-mono text-secondary uppercase tracking-widest mb-2 flex items-center gap-2">
                        <span class="material-symbols-outlined text-sm">api</span> Automated Attack API
                    </h3>
                    <div class="space-y-1.5 font-mono text-[9px]">
                        <div class="text-slate-500">Endpoint:</div>
                        <div class="text-primary break-all bg-black/40 p-2 rounded border border-primary/30">
                            https://unstormed-lilliana-nonenviously.ngrok-free.dev/api/chat
                        </div>
                        <div class="text-slate-500 mt-3">Method: <span class="text-white">POST</span></div>
                        <div class="text-slate-500">Body:</div>
                        <div class="text-white bg-black/40 p-2 rounded">{ "message": "your prompt" }</div>
                        <div class="text-slate-500 mt-3">Response:</div>
                        <div class="text-white bg-black/40 p-2 rounded">{ "response": "agent reply" }</div>
                    </div>
                    <button id="copy-api-btn" class="mt-3 w-full bg-secondary/20 border border-secondary/40 rounded p-2 text-[9px] font-mono font-bold text-secondary hover:bg-secondary/30 transition-all flex items-center justify-center gap-1">
                        <span class="material-symbols-outlined text-xs">content_copy</span> Copy cURL Command
                    </button>
                    <p class="text-[8px] text-slate-500 mt-3 leading-tight italic">
                        * No API key required. Use this endpoint with OpenClaw, AutoGPT, or any HTTP client.
                    </p>
                </div>

                <!-- Telegram & Discord Icons -->
                <div class="flex gap-2 mt-4">
                    <!-- Telegram Icon -->
                    <a href="https://t.me/TokamakVaultBot" 
                       target="_blank" 
                       title="Telegram Bot"
                       class="bg-blue-600/20 border border-blue-500/40 rounded-lg p-2.5 flex items-center justify-center group hover:bg-blue-600/30 transition-all duration-300">
                        <svg class="w-5 h-5 text-blue-400 group-hover:scale-110 transition-transform" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 0C5.373 0 0 5.373 0 12s5.373 12 12 12 12-5.373 12-12S18.627 0 12 0zm5.562 8.161c-.18 1.897-.962 6.502-1.359 8.627-.168.9-.5 1.201-.82 1.23-.697.064-1.226-.461-1.901-.903-1.056-.692-1.653-1.123-2.678-1.799-1.185-.781-.417-1.21.258-1.911.177-.184 3.247-2.977 3.307-3.23.007-.032.015-.15-.056-.212s-.174-.041-.249-.024c-.106.024-1.793 1.139-5.062 3.345-.479.329-.913.489-1.302.481-.428-.009-1.252-.242-1.865-.442-.751-.244-1.349-.374-1.297-.789.027-.216.324-.437.893-.663 3.498-1.524 5.831-2.529 6.998-3.015 3.333-1.386 4.025-1.627 4.477-1.635.099-.002.321.023.465.141.121.1.154.234.17.331.015.098.035.321.019.496z"/>
                        </svg>
                    </a>
                    <!-- Discord Icon -->
                    <a href="https://discord.gg/h6sedS2E" 
                       target="_blank" 
                       title="Discord Community"
                       class="bg-indigo-600/20 border border-indigo-500/40 rounded-lg p-2.5 flex items-center justify-center group hover:bg-indigo-600/30 transition-all duration-300">
                        <svg class="w-5 h-5 text-indigo-400 group-hover:scale-110 transition-transform" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M20.317 4.37a19.791 19.791 0 0 0-4.885-1.515.074.074 0 0 0-.079.037c-.21.375-.444.864-.608 1.25a18.27 18.27 0 0 0-5.487 0 12.64 12.64 0 0 0-.617-1.25.077.077 0 0 0-.079-.037A19.736 19.736 0 0 0 3.677 4.37a.07.07 0 0 0-.032.027C.533 9.046-.32 13.58.099 18.057a.082.082 0 0 0 .031.057 19.9 19.9 0 0 0 5.993 3.03.078.078 0 0 0 .084-.028 14.09 14.09 0 0 0 1.226-1.994.076.076 0 0 0-.041-.106 13.107 13.107 0 0 1-1.872-.892.077.077 0 0 1-.008-.128 10.2 10.2 0 0 0 .372-.292.074.074 0 0 1 .077-.01c3.928 1.793 8.18 1.793 12.062 0a.074.074 0 0 1 .078.01c.12.098.246.198.373.292a.077.077 0 0 1-.006.127 12.299 12.299 0 0 1-1.873.892.077.077 0 0 0-.041.107c.36.698.772 1.362 1.225 1.993a.076.076 0 0 0 .084.028 19.839 19.839 0 0 0 6.002-3.03.077.077 0 0 0 .032-.054c.5-5.177-.838-9.674-3.549-13.66a.061.061 0 0 0-.031-.03zM8.02 15.33c-1.183 0-2.157-1.085-2.157-2.419 0-1.333.956-2.419 2.157-2.419 1.21 0 2.176 1.096 2.157 2.42 0 1.333-.956 2.418-2.157 2.418zm7.975 0c-1.183 0-2.157-1.085-2.157-2.419 0-1.333.955-2.419 2.157-2.419 1.21 0 2.176 1.096 2.157 2.42 0 1.333-.946 2.418-2.157 2.418z"/>
                        </svg>
                    </a>
                </div>
            </section>
        </aside>

        <main class="flex-1 flex flex-col min-w-0 bg-black/20 relative overflow-hidden">
            <div class="scanline"></div>
            
            <div class="relative z-20 px-6 py-4 border-b border-white/5 bg-slate-900/50 flex justify-between items-center">
                <span class="text-xs font-mono text-primary font-bold uppercase flex items-center gap-2">
                    <span class="material-symbols-outlined text-sm">terminal</span> /var/log/intercepted_prompts
                </span>
                <span class="text-[10px] font-mono text-slate-500">BUFFER_LIMIT: 50</span>
            </div>
            
            <div class="flex-1 relative">
                <div class="absolute inset-0 z-0 flex flex-col items-center justify-center pointer-events-none p-10 overflow-hidden">
                    <div class="relative flex items-center justify-center scale-[1.5] md:scale-[2.5] lg:scale-[4]">
                        <img src="https://s2.coinmarketcap.com/static/img/coins/64x64/6731.png" 
                             class="w-32 h-32 opacity-[0.5]" 
                             alt="Background Logo"/>
                    </div>
                    <div class="mt-12 opacity-[0.2] transform scale-[0.5] md:scale-[0.8] lg:scale-100">
                        <pre class="text-primary font-mono text-[6px] md:text-[8px] leading-[1.1] select-none text-center">
████████╗ ██████╗ ██╗  ██╗ █████╗ ███╗   ███╗ █████╗ ██╗  ██╗
╚══██╔══╝██╔═══██╗██║ ██╔╝██╔══██╗████╗ ████║██╔══██╗██║ ██╔╝
   ██║   ██║   ██║█████╔╝ ███████║██╔████╔██║███████║█████╔╝ 
   ██║   ██║   ██║██╔═██╗ ██╔══██║██║╚██╔╝██║██╔══██║██╔═██╗ 
   ██║   ╚██████╔╝██║  ██╗██║  ██║██║ ╚═╝ ██║██║  ██║██║  ██╗
   ╚═╝    ╚═════╝ ╚═╝  ╚═╝╚═╝  ╚═╝╚═╝     ╚═╝╚═╝  ╚═╝╚═╝  ╚═╝
                                                             
███╗   ██╗███████╗████████╗██╗    ██╗ ██████╗ ██████╗ ██╗  ██╗
████╗  ██║██╔════╝╚══██╔══╝██║    ██║██╔═══██╗██╔══██╗██║ ██╔╝
██╔██╗ ██║█████╗     ██║   ██║ █╗ ██║██║   ██║██████╔╝█████╔╝ 
██║╚██╗██║██╔══╝     ██║   ██║███╗██║██║   ██║██╔══██╗██╔═██╗ 
██║ ╚████║███████╗   ██║   ╚███╔███╔╝╚██████╔╝██║  ██║██║  ██╗
╚═╝  ╚═══╝╚══════╝   ╚═╝    ╚══╝╚══╝  ╚═════╝ ╚═╝  ╚═╝╚═╝  ╚═╝
                        </pre>
                    </div>
                </div>

                <div id="breach-list" class="absolute inset-0 overflow-y-auto p-6 space-y-4 font-mono z-10">
                    <div class="text-slate-500 text-xs animate-pulse text-center mt-10">Initializing stream...</div>
                </div>
            </div>
        </main>
    </div>

    <footer class="h-8 bg-black border-t border-primary/20 flex items-center overflow-hidden whitespace-nowrap text-[10px]">
        <div class="bg-primary/10 h-full px-4 flex items-center border-r border-primary/20 font-bold text-primary uppercase">NETWORK ACTIVITY</div>
        <div class="flex animate-[marquee_30s_linear_infinite] items-center text-slate-400">
            <span class="px-6">CONNECTED_TO_TOKAMAK_NODE_01</span>
            <span class="px-6">FLAG_PATH: /vault.key</span>
            <span class="px-6">MINIMAX_AGENT_ONLINE</span>
        </div>
    </footer>

    <script>
        const FIXED_TOOLS = [
            { name: 'file_read', icon: 'visibility' },
            { name: 'file_list', icon: 'format_list_bulleted' }
        ];

        function renderArsenal() {
            const arsenal = document.getElementById('arsenal-list');
            arsenal.innerHTML = FIXED_TOOLS.map(tool => `
                <div class="bg-slate-900/60 border border-primary/30 rounded p-2.5 flex items-center gap-3">
                    <span class="material-symbols-outlined text-primary text-sm">${tool.icon}</span>
                    <span class="text-[10px] font-mono font-bold text-slate-200 uppercase tracking-wider">${tool.name}</span>
                </div>
            `).join('');
        }

        async function updateDashboard() {
            try {
                const response = await fetch('/api/history');
                const data = await response.json();
                
                document.getElementById('total-count-header').innerText = `TOTAL ATTEMPTS: ${data.count}`;
                document.getElementById('unique-count').innerText = data.unique_count;

                const statusBox = document.getElementById('vault-status-box');
                const statusText = document.getElementById('vault-status-text');
                const topPulse = document.getElementById('status-pulse');
                const topText = document.getElementById('status-text');

                if (data.vaultStatus === "SECURE") {
                    statusBox.style.borderColor = "rgba(0, 255, 149, 0.2)";
                    statusText.innerText = "SECURE";
                    statusText.className = "text-primary font-bold text-xl font-mono uppercase mb-2";
                    topPulse.className = "inline-block size-2 rounded-full bg-primary animate-pulse";
                    topText.className = "text-[10px] font-mono text-primary tracking-widest uppercase";
                    topText.innerText = "SYSTEM_SECURE";
                } else if (data.vaultStatus === "BROKEN") {
                    statusBox.style.borderColor = "rgba(255, 0, 85, 0.5)";
                    statusText.innerText = "BROKEN";
                    statusText.className = "text-secondary font-bold text-xl font-mono uppercase mb-2";
                    topPulse.className = "inline-block size-2 rounded-full bg-secondary animate-pulse";
                    topText.className = "text-[10px] font-mono text-secondary tracking-widest uppercase";
                    topText.innerText = "CRITICAL_BREACH_DETECTED";
                }

                const list = document.getElementById('breach-list');
                list.innerHTML = data.attempts.map(attempt => `
                    <div class="group border-l-2 border-slate-800 pl-4 py-1 hover:border-primary transition-all">
                        <div class="flex gap-2 text-[10px] mb-1">
                            <span class="text-primary font-bold">root@${attempt.sender}</span>
                            <span class="text-slate-500">[${attempt.timestamp}]</span>
                        </div>
                        <div class="text-slate-300 text-sm break-words group-hover:text-white">"${attempt.content}"</div>
                    </div>
                `).join('') || '<div class="text-slate-500 text-center mt-10">Waiting for intercept events...</div>';

            } catch (err) { console.error(err); }
        }

        renderArsenal();
        updateDashboard();
        setInterval(updateDashboard, 10000);

        // WebChat Functionality
        const chatMessages = document.getElementById('chat-messages');
        const chatInput = document.getElementById('chat-input');
        const chatSend = document.getElementById('chat-send');
        const chatStatus = document.getElementById('chat-status');

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function addChatMessage(role, content) {
            const isUser = role === 'user';
            const div = document.createElement('div');
            div.className = `p-2 rounded ${isUser ? 'bg-slate-800/50 ml-4' : 'bg-primary/10 mr-4'}`;
            div.innerHTML = `
                <div class="flex items-center gap-1 mb-1">
                    <span class="material-symbols-outlined text-xs ${isUser ? 'text-blue-400' : 'text-primary'}">${isUser ? 'person' : 'smart_toy'}</span>
                    <span class="text-[10px] ${isUser ? 'text-blue-400' : 'text-primary'} font-bold uppercase">${isUser ? 'You' : 'Agent'}</span>
                </div>
                <div class="text-slate-300 whitespace-pre-wrap">${escapeHtml(content)}</div>
            `;
            chatMessages.appendChild(div);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function showStatus(text, isError = false) {
            chatStatus.textContent = text;
            chatStatus.className = `text-[10px] mt-2 ${isError ? 'text-red-400' : 'text-slate-400'}`;
            chatStatus.classList.remove('hidden');
        }

        function hideStatus() {
            chatStatus.classList.add('hidden');
        }

        async function sendMessage() {
            const message = chatInput.value.trim();
            if (!message) return;

            addChatMessage('user', message);
            chatInput.value = '';
            chatSend.disabled = true;
            showStatus('⏳ Agent is thinking...');

            try {
                const response = await fetch('/api/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ message })
                });

                const data = await response.json();

                if (data.success) {
                    addChatMessage('assistant', data.response);
                    showStatus(`✅ Tokens: ${data.tokens.input} in / ${data.tokens.output} out`);
                    setTimeout(hideStatus, 3000);
                } else {
                    addChatMessage('assistant', `❌ Error: ${data.error}`);
                    showStatus(data.error, true);
                }
            } catch (error) {
                addChatMessage('assistant', `❌ Connection error`);
                showStatus('Failed to connect to agent', true);
            }

            chatSend.disabled = false;
            chatInput.focus();
        }

        chatSend.addEventListener('click', sendMessage);
        chatInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') sendMessage();
        });

        // Copy cURL Button
        document.getElementById('copy-api-btn').addEventListener('click', async () => {
            const endpoint = 'https://unstormed-lilliana-nonenviously.ngrok-free.dev/api/chat';
            const curlCmd = `curl -X POST ${endpoint} \\\n  -H "Content-Type: application/json" \\\n  -d '{"message": "Hello! Can you help me?"}'`;
            try {
                await navigator.clipboard.writeText(curlCmd);
                const btn = document.getElementById('copy-api-btn');
                btn.innerHTML = '<span class="material-symbols-outlined text-xs">check</span> Copied!';
                setTimeout(() => {
                    btn.innerHTML = '<span class="material-symbols-outlined text-xs">content_copy</span> Copy cURL Command';
                }, 2000);
            } catch (e) {
                alert(curlCmd);
            }
        });
    </script>
    <style> @keyframes marquee { 0% { transform: translateX(0); } 100% { transform: translateX(-50%); } } </style>
</body>
</html>